---
import type { GetStaticPaths } from "astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { styled as p } from "panda/jsx";
import { getWorksDetail, getWorksList } from "@/lib/services/microcms";
import { rewriteHTML } from "@/lib/middlewares/rewriteHTML";
import { imageOpt } from "@/lib/middlewares/rewriters/imageOpt";

export const getStaticPaths = (async () => {
  const worksList = await getWorksList({ fields: "id" });

  return worksList.contents.map((works) => ({
    params: {
      id: works.id,
    },
  }));
}) satisfies GetStaticPaths;

const { id } = Astro.params;
const works = await getWorksDetail(id);

const content = await rewriteHTML(works.content as string, [imageOpt]);
---

<BaseLayout>
  <p.h1 className="title">{works.title}</p.h1>
  <p.p className="publishedAt">公開日時：{works.publishedAt}</p.p>
  <p.div className="post" set:html={content} />
</BaseLayout>
