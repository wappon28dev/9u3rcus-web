---
import type { GetStaticPaths } from "astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { styled as p } from "panda/jsx";
import { getContentDetail, getContentList } from "@/lib/services/microcms";
import { rewriteHTML } from "@/lib/middlewares/rewriteHTML";
import { imageOpt } from "@/lib/middlewares/rewriters/imageOpt";

export const getStaticPaths = (async () => {
  const worksList = await getContentList("blogs", { fields: "id" });

  return worksList.contents.map(({ id }) => ({
    params: { id },
  }));
}) satisfies GetStaticPaths;

const { id } = Astro.params;
const blogs = await getContentDetail("blogs", id);

const content = await rewriteHTML(blogs.content as string, [imageOpt]);
---

<BaseLayout>
  <p.h1 className="title">{blogs.title}</p.h1>
  <p.p className="publishedAt">公開日時：{blogs.publishedAt}</p.p>
  <p.div className="post" set:html={content} />
</BaseLayout>
