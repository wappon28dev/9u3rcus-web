---
import type { GetStaticPaths } from "astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { styled as p } from "panda/jsx";
import { Image } from "astro:assets";
import {
  // getContentDetail,
  // getContentList,
  worksDetailsMock,
  worksListMock,
} from "@/lib/services/microcms";
import { rewriteHTML } from "@/lib/middlewares/rewriteHTML";
import BackTo from "@/components/BackTo.astro";
import { formatDate } from "@/lib/constants";

export const getStaticPaths = (async () => {
  // const worksList = await getContentList("works", { fields: "id" });
  const worksList = worksListMock;

  return worksList.contents.map(({ id }) => ({
    params: { id },
  }));
}) satisfies GetStaticPaths;

// const { id } = Astro.params;
// const works = await getContentDetail("works", id);
const { id, title, ogpImg, releaseDate, clientName, description, content } =
  worksDetailsMock;

const modifiedContent = await rewriteHTML(content as string);
---

<BaseLayout>
  <p.article
    alignItems="center"
    display="flex"
    flexDir="column"
    gap="5"
    pb="20"
    py="0"
  >
    <p.nav w="100%">
      <BackTo href="/works" txt="Works" />
    </p.nav>
    <p.div
      display="flex"
      justifyContent="center"
      maxHeight="1200px"
      style={{
        viewTransitionName: `works-${id}`,
      }}
      w="100%"
    >
      <Image
        alt={title}
        height={ogpImg.height}
        src={ogpImg.url}
        width={ogpImg.width}
      />
    </p.div>
    <p.h1 color="9u-red1" fontSize="4xl" fontWeight="bold" textAlign="center"
      >{title}</p.h1
    >
    <p.section textAlign="center">
      <p.p>{formatDate(new Date(releaseDate), "YYYY.MM")}</p.p>
      {
        clientName != null && (
          <p.p fontSize="lg" fontWeight="bold">
            Client: {clientName}
          </p.p>
        )
      }
    </p.section>
    <p.section
      fontSize="lg"
      fontWeight="bold"
      textAlign="center"
      w={{ base: "80%", mdDown: "100%" }}
    >
      {description}
    </p.section>
    <p.div set:html={modifiedContent} w="100%" />
  </p.article>
</BaseLayout>
