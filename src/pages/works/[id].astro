---
import type { GetStaticPaths } from "astro";
import BaseLayout from "@layouts/BaseLayout.astro";
import { styled as p } from "panda/jsx";
import { Image } from "astro:assets";
import { contentStyle } from "@/lib/style";
import { rewriteHTML } from "@/lib/middlewares/rewrite-html";
import BackTo from "@/components/BackTo.astro";
import { formatDate } from "@/lib/constants";
import { replaceAssetsDomain } from "@/lib/middlewares/rewriters/convert2media";
import { getContentDetail, getContentList } from "@/lib/services/microcms";

export const getStaticPaths = (async () => {
  const worksList = await getContentList("works", { fields: "id" });

  return worksList.contents.map(({ id }) => ({
    params: { id },
  }));
}) satisfies GetStaticPaths;

const { id } = Astro.params;
const { title, visualMain, releaseDate, clientName, description, content } =
  await getContentDetail("works", id);

const modifiedContent = await rewriteHTML(content as string);
---

<BaseLayout>
  <p.article
    alignItems="center"
    display="flex"
    flexDir="column"
    gap="5"
    pb="20"
    py="0"
  >
    <p.nav w="100%">
      <BackTo href="/works" txt="Works" />
    </p.nav>
    <p.div
      display="flex"
      justifyContent="center"
      m="0 auto"
      maxHeight="1200px"
      style={{
        viewTransitionName: `works-${id}`,
      }}
      w="fit-content"
    >
      <Image alt={title} inferSize src={replaceAssetsDomain(visualMain)} />
    </p.div>
    <p.h1 color="9u-red1" fontSize="4xl" fontWeight="bold" textAlign="center">
      {title}
    </p.h1>
    <p.section textAlign="center">
      <p.p>{formatDate(new Date(releaseDate), "YYYY.MM")}</p.p>
      {
        clientName != null && (
          <p.p fontSize="lg" fontWeight="bold">
            Client: {clientName}
          </p.p>
        )
      }
    </p.section>
    <p.section
      fontSize="lg"
      fontWeight="bold"
      textAlign="center"
      w={{ base: "80%", mdDown: "100%" }}
    >
      {description}
    </p.section>
    <p.hr w="100%" />
    <p.div className={contentStyle} set:html={modifiedContent} w="100%" />
  </p.article>
</BaseLayout>
